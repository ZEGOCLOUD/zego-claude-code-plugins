---
name: server-token-integration
description: This skill should be used when the user asks to "integrate ZEGO Token generation", "add Token endpoint", "implement server-side Token API", "generate Token on server", or needs help with ZEGO Token server integration. Provides SDK download and route implementation guidance for Token generation.
version: 1.0.0
---

# ZEGO Server Token Integration

This skill provides guidance for integrating ZEGO Token generation API on the server side. ZEGO Token is required for client SDK authentication and must be generated by the server using the Server Assistant SDK.

## Overview

Token generation involves:
1. Detecting the server-side programming language
2. Downloading the appropriate ZEGO Server Assistant SDK
3. Implementing a GET endpoint at `/api/zego/token`
4. Configuring environment variables for AppID and Server Secret

## Supported Languages

The following languages are supported with official SDKs:

| Language  | SDK Identifier |
|-----------|----------------|
| Go        | GO             |
| C++       | CPP            |
| Java      | JAVA           |
| Python    | PYTHON         |
| Node.js   | NODEJS         |
| PHP       | PHP            |
| C#        | CSHARP         |

If the requested language is not in the list, use the Node.js SDK as a reference implementation.

## Workflow

### Step 1: Detect Server Language

Analyze the codebase to identify the server-side programming language:

1. Check for common server framework files:
   - **Node.js**: `package.json`, files with `.js` or `.ts` extensions in server directories
   - **Python**: `requirements.txt`, `setup.py`, `pyproject.toml`, files with `.py` extension
   - **Go**: `go.mod`, files with `.go` extension
   - **Java**: `pom.xml` (Maven), `build.gradle` (Gradle), files with `.java` extension
   - **PHP**: `composer.json`, files with `.php` extension
   - **C#**: `.csproj` file, files with `.cs` extension
   - **C++**: `CMakeLists.txt`, files with `.cpp` or `.cc` extension

2. Search for existing API/route directories to understand the project structure
3. If language cannot be determined, ask the user to specify

### Step 2: Download SDK

Use the download script to fetch the appropriate SDK:

```bash
python scripts/download_sdk.py --language <LANGUAGE_ID>
```

The script intelligently determines the download location based on project structure:

1. **Existing zego directory** - If a `zego/` directory exists in the project, uses it
2. **Language-recommended directory** - Tries language-specific paths (e.g., `utils/zego/token`, `pkg/zego/token`)
3. **Project common directory** - Uses existing common directories (`lib/`, `utils/`, `sdk/`, `services/`)
4. **Src directory** - If `src/` exists, uses `src/zego/token`
5. **Default** - Falls back to `workspace/zego/token`

If the language is not supported, download the Node.js version as reference:

```bash
python scripts/download_sdk.py --language NODEJS
```

Refer to `references/sdk-urls.md` for all SDK download URLs.

### Step 3: Implement Token Endpoint

Create a GET endpoint at `/api/zego/token` with the following specifications:

**Endpoint**: `GET /api/zego/token`

**Parameters**:
| Parameter      | Type   | Required | Default | Description                |
|----------------|--------|----------|---------|----------------------------|
| userId         | string | Yes      | -       | User unique identifier     |
| effectiveTime  | number | No       | 3600    | Token validity in seconds  |
| payload        | string | No       | ""      | Permission payload (JSON)  |

**Environment Variables**:
```bash
ZEGO_APP_ID=1234567890
ZEGO_SERVER_SECRET=your_server_secret_here
```

**Response**: Plain text string containing the generated Token

**HTTP Status Codes**:
- `200` - Token generated successfully
- `400` - Missing required parameters
- `500` - Token generation failed

### Step 4: Add Environment Variables

Add the required environment variables to the project's configuration:

- For local development: Add to `.env` file
- For production: Configure in deployment environment (CI/CD, cloud provider, etc.)

Do NOT commit actual secrets to version control.

## Additional Resources

### Reference Files

- **`references/sdk-urls.md`** - Complete list of SDK download URLs for all supported languages
- **`references/api-spec.md`** - Detailed API specification and response formats

### Example Implementations

Working examples in `examples/`:
- **`examples/node.ts`** - Express.js implementation (TypeScript)
- **`examples/python.py`** - Flask/FastAPI implementation
- **`examples/go.go`** - Gin/Net HTTP implementation
- **`examples/java.java`** - Spring Boot implementation
- **`examples/php.php`** - Generic PHP implementation
- **`examples/csharp.cs`** - ASP.NET Core implementation

### Scripts

- **`scripts/download_sdk.py`** - Downloads the appropriate SDK based on language

## Important Notes

1. **Security**: Never expose the Server Secret on the client side. Token generation must happen on the server.
2. **Token Validity**: Default validity is 3600 seconds (1 hour). Adjust based on security requirements.
3. **Payload**: The payload parameter can be used to pass additional permission data in JSON format.
4. **SDK Version**: Use the token04 version of the SDK for current ZEGO services.
5. **Error Handling**: Implement proper error handling and logging for Token generation failures.

## Troubleshooting

**SDK Download Fails**: Check network connectivity and GitHub accessibility. Use a mirror if needed.

**Token Validation Fails**: Verify AppID and Server Secret are correct and match the console project.

**Language Not Supported**: Download the Node.js SDK as reference and translate the logic to the target language.